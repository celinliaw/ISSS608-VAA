---
title: "Take-Home_Ex02P1"
author: "Liaw Ying Ting, Celin"
date: 27 May 2025
date-modified: "last-modified"

format:
  html:
    code-fold: true
    code-tools: true

execute: 
  eval: true
  echo: true
  warning: false
  freeze: true
---

```{R}
pacman::p_load(
  tidyverse,    # dplyr, tidyr, ggplot2, purrr, readr, etc.
  jsonlite,
  tidygraph,
  ggraph,
  visNetwork,   # only for Q2-A (interactive)
  circlize,     # only for Q2-B
  patchwork     # only for Q3-B
)


```

```{r}
# -- 1.1  read raw ----------------------------------------------------------
MC3 <- jsonlite::fromJSON("data/MC3_graph.json")

# ── 1.2  tidy nodes  (no duplicate names, unique vertex key) ──────────────
nodes_tbl <- as_tibble(MC3$nodes) %>%
  mutate(id_chr = as.character(id)) %>%          # numeric id → character
  distinct(id_chr, .keep_all = TRUE) %>%
  rename(orig_name  = name) %>%                  # keep the old "name" safely
  # 'label' already exists in the JSON; leave it untouched
  mutate(name = id_chr) %>%                      # <- vertex key for igraph
  select(-id, -id_chr)                           # drop raw id cols (optional)

# columns now are:  name (unique key), orig_name, label, type, sub_type, …
# check for duplicates -----
anyDuplicated(names(nodes_tbl))   # should return 0

```

```{R}
# 1.3  tidy edges  ---------------------------------------------------------
edges_tbl <- as_tibble(MC3$edges) %>%
  rename(from = source, to = target) %>%
  mutate(across(c(from, to), as.character))   # numeric IDs → character

# 1.4  drop edges pointing to missing nodes (just in case) -----------------
missing <- setdiff(unique(c(edges_tbl$from, edges_tbl$to)), nodes_tbl$name)
if (length(missing)) {
  warning("Dropped ", length(missing), " edges with unknown node IDs.")
  edges_tbl <- edges_tbl %>% filter(!from %in% missing, !to %in% missing)
}

# 1.5  build graph ---------------------------------------------------------
library(igraph)
ig <- graph_from_data_frame(d = edges_tbl,
                            directed = TRUE,
                            vertices = nodes_tbl)

library(tidygraph)
g <- as_tbl_graph(ig)   # tidygraph object
g                        # should print summary without errors

```
