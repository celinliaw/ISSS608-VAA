{
  "hash": "2d7f6b236573de0d05c49db192050ba7",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take-Home_Ex02\"\nauthor: \"Liaw Ying Ting, Celin\"\ndate: 27 May 2025\ndate-modified: \"last-modified\"\n\nformat:\n  html:\n    code-fold: true\n    code-tools: true\n\nexecute: \n  eval: true\n  echo: true\n  warning: false\n  freeze: true\n---\n\n\n\n# Overview\n\nFor this take-home exercise 2, Mini-Challenge 3 will be chosen and the visualisation will be done on this topic. The background of the mini challenge and the questions will be listed below. For this mini challenge, I will only be displaying and addressing Question 3 below.\n\n# Background\n\nOver the past decade, the community of Oceanus has faced numerous transformations and challenges evolving from its fishing-centric origins. Following major crackdowns on illegal fishing activities, suspects have shifted investments into more regulated sectors such as the ocean tourism industry, resulting in growing tensions. This increased tourism has recently attracted the likes of international pop star Sailor Shift, who announced plans to film a music video on the island.\n\nClepper Jessen, a former analyst at FishEye and now a seasoned journalist for the Hacklee Herald, has been keenly observing these rising tensions. Recently, he turned his attention towards the temporary closure of Nemo Reef. By listening to radio communications and utilizing his investigative tools, Clepper uncovered a complex web of expedited approvals and secretive logistics. These efforts revealed a story involving high-level Oceanus officials, Sailor Shift’s team, local influential families, and local conservationist group The Green Guardians, pointing towards a story of corruption and manipulation.\n\n# Task and Question\n\nClepper diligently recorded all intercepted radio communications over the last two weeks. With the help of his intern, they have analyzed their content to identify important events and relationships between key players. The result is a knowledge graph describing the last two weeks on Oceanus. Clepper and his intern have spent a large amount of time generating this knowledge graph, and they would now like some assistance using it to answer the following questions.\n\n1.  **Clepper found that messages frequently came in at around the same time each day.**\n\n    -   Develop a graph-based visual analytics approach to identify any daily temporal patterns in communications.\n\n    -   How do these patterns shift over the two weeks of observations?\n\n    -   Focus on a specific entity and use this information to determine who has influence over them.\n\n2.  **Clepper has noticed that people often communicate with (or about) the same people or vessels, and that grouping them together may help with the investigation.**\n\n    -   Use visual analytics to help Clepper understand and explore the interactions and relationships between vessels and people in the knowledge graph.\n\n    -   Are there groups that are more closely associated? If so, what are the topic areas that are predominant for each group?\n\n        -   For example, these groupings could be related to: Environmentalism (known associates of Green Guardians), Sailor Shift, and fishing/leisure vessels.\n\n3.  **It was noted by Clepper’s intern that some people and vessels are using pseudonyms to communicate.**\n\n    -   Expanding upon your prior visual analytics, determine who is using pseudonyms to communicate, and what these pseudonyms are.\n\n        Some that Clepper has already identified include: “Boss”, and “The Lookout”, but there appear to be many more.\n\n        To complicate the matter, pseudonyms may be used by multiple people or vessels.\n\n    -   Describe how your visualizations make it easier for Clepper to identify common entities in the knowledge graph.\n\n    -   How does your understanding of activities change given your understanding of pseudonyms?\n\n4.  **Clepper suspects that Nadia Conti, who was formerly entangled in an illegal fishing scheme, may have continued illicit activity within Oceanus.**\n\n    -   Through visual analytics, provide evidence that Nadia is, or is not, doing something illegal.\n\n    -   Summarize Nadia’s actions visually. Are Clepper’s suspicions justified?\n\n**Reflection Questions**\n\n-   Given the task to develop visualizations for knowledge graphs, did you find that the challenge pushed you to develop new techniques for visual representation?\n\n-   Did you participate in last year’s challenge? If so, did your experience last year help prepare you for this year’s challenge?\n\n-   What was the most difficult part of working on this year’s data and what could have made it more accessible?\n\n# MC3 Kickstarter\n\n## Getting Started\n\nIn the code chunk below, `p_load()` of pacman package is used to load the R packages into R environment.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tidyverse, jsonlite,\n               tidygraph, ggraph,\n               SmartEDA)\n```\n:::\n\n\n\n## Import knowledge Graph Data\n\nFor this exercise, *mc3.json* file will be used. In the code chunk below, `fromJSON()` of jsonlite package is used to import *mc3.json* file into R and save the output object.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nMC3 <- fromJSON(\"data/MC3_graph.json\")\nMC3_schema <- fromJSON(\"data/MC3_schema.json\")\n```\n:::\n\n\n\n## Inspecting Knowledge graph structure\n\nIn the code chunk below, `glimpse()` is used to reveal the structure of the *mc3* knowledge graph.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(MC3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nList of 5\n $ directed  : logi TRUE\n $ multigraph: logi FALSE\n $ graph     :List of 4\n  ..$ mode        : chr \"static\"\n  ..$ edge_default: Named list()\n  ..$ node_default: Named list()\n  ..$ name        : chr \"VAST_MC3_Knowledge_Graph\"\n $ nodes     :'data.frame':\t1159 obs. of  31 variables:\n  ..$ type             : chr [1:1159] \"Entity\" \"Entity\" \"Entity\" \"Entity\" ...\n  ..$ label            : chr [1:1159] \"Sam\" \"Kelly\" \"Nadia Conti\" \"Elise\" ...\n  ..$ name             : chr [1:1159] \"Sam\" \"Kelly\" \"Nadia Conti\" \"Elise\" ...\n  ..$ sub_type         : chr [1:1159] \"Person\" \"Person\" \"Person\" \"Person\" ...\n  ..$ id               : chr [1:1159] \"Sam\" \"Kelly\" \"Nadia Conti\" \"Elise\" ...\n  ..$ timestamp        : chr [1:1159] NA NA NA NA ...\n  ..$ monitoring_type  : chr [1:1159] NA NA NA NA ...\n  ..$ findings         : chr [1:1159] NA NA NA NA ...\n  ..$ content          : chr [1:1159] NA NA NA NA ...\n  ..$ assessment_type  : chr [1:1159] NA NA NA NA ...\n  ..$ results          : chr [1:1159] NA NA NA NA ...\n  ..$ movement_type    : chr [1:1159] NA NA NA NA ...\n  ..$ destination      : chr [1:1159] NA NA NA NA ...\n  ..$ enforcement_type : chr [1:1159] NA NA NA NA ...\n  ..$ outcome          : chr [1:1159] NA NA NA NA ...\n  ..$ activity_type    : chr [1:1159] NA NA NA NA ...\n  ..$ participants     : int [1:1159] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ thing_collected  :'data.frame':\t1159 obs. of  2 variables:\n  .. ..$ type: chr [1:1159] NA NA NA NA ...\n  .. ..$ name: chr [1:1159] NA NA NA NA ...\n  ..$ reference        : chr [1:1159] NA NA NA NA ...\n  ..$ date             : chr [1:1159] NA NA NA NA ...\n  ..$ time             : chr [1:1159] NA NA NA NA ...\n  ..$ friendship_type  : chr [1:1159] NA NA NA NA ...\n  ..$ permission_type  : chr [1:1159] NA NA NA NA ...\n  ..$ start_date       : chr [1:1159] NA NA NA NA ...\n  ..$ end_date         : chr [1:1159] NA NA NA NA ...\n  ..$ report_type      : chr [1:1159] NA NA NA NA ...\n  ..$ submission_date  : chr [1:1159] NA NA NA NA ...\n  ..$ jurisdiction_type: chr [1:1159] NA NA NA NA ...\n  ..$ authority_level  : chr [1:1159] NA NA NA NA ...\n  ..$ coordination_type: chr [1:1159] NA NA NA NA ...\n  ..$ operational_role : chr [1:1159] NA NA NA NA ...\n $ edges     :'data.frame':\t3226 obs. of  5 variables:\n  ..$ id         : chr [1:3226] \"2\" \"3\" \"5\" \"3013\" ...\n  ..$ is_inferred: logi [1:3226] TRUE FALSE TRUE TRUE TRUE TRUE ...\n  ..$ source     : chr [1:3226] \"Sam\" \"Sam\" \"Sam\" \"Sam\" ...\n  ..$ target     : chr [1:3226] \"Relationship_Suspicious_217\" \"Event_Communication_370\" \"Event_Assessment_600\" \"Relationship_Colleagues_430\" ...\n  ..$ type       : chr [1:3226] NA \"sent\" NA NA ...\n```\n\n\n:::\n:::\n\n\n\n## Extracting the edges and nodes tables\n\nNext, `as_tibble()` of tibble package is used to extract the nodes and links tibble data frames from *mc3* tibble dataframe into two separate tibble dataframes called *mc3_nodes* and *mc3_edges* respectively.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc3_nodes <- as_tibble(MC3$nodes)\nmc3_edges <- as_tibble(MC3$edges)\n```\n:::\n\n\n\n## Initial EDA\n\nIn the code chunk below, `ExpCatViz()` of SmartEDA package is used to reveal the frequency distribution of all categorical fields in *mc3_nodes* tibble dataframe\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nExpCatViz(data=mc3_nodes,\n          col=\"lightblue\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n[[2]]\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-5-2.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n[[3]]\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-5-3.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n[[4]]\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-5-4.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n[[5]]\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-5-5.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n[[6]]\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-5-6.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n[[7]]\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-5-7.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n[[8]]\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-5-8.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n[[9]]\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-5-9.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n[[10]]\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-5-10.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n[[11]]\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-5-11.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n[[12]]\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-5-12.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n[[13]]\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-5-13.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n[[14]]\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-5-14.png){width=672}\n:::\n:::\n\n\n\nOn the other hand, code chunk below uses `ExpCATViz()` of SmartEDA package to reveal the frequency distribution of all categorical fields in *mc3_edges* tibble dataframe\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nExpCatViz(data=mc3_edges,\n          col=\"lightblue\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n## Data Cleaning and Wrangling\n\nThe code chunk below performs the following data cleaning tasks:\n\n-   convert values in id field into character data type\n\n-   exclude records with `id` value\n\n-   exclude records with similar id values\n\n-   exclude `thing_collected` field\n\n-   save the cleaned tibble dataframe into a new tibble datatable called `mc_nodes_cleaned`\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc3_nodes_cleaned <- mc3_nodes %>%\n  mutate(id = as.character(id)) %>%\n  filter(!is.na(id)) %>%\n  distinct(id, .keep_all = TRUE) %>%\n  select(-thing_collected)\n```\n:::\n\n\n\n## Cleaning and wrangling edges\n\nNext, the code chunk will be used to:\n\n-   rename source and target fields to form_id and to_id respectively\n\n-   convert values in from_id and to_id fields to character data type\n\n-   exclude values in from_id and to_id which is not found in the id field of mc3_nodes_cleaned\n\n-   exclude records whereby from_id and/or to_id values are missing\n\n-   save the cleaned tibble dataframe and call it mc3_edges_cleaned\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc3_edges_cleaned <- mc3_edges %>%\n  rename(from_id = source,\n         to_id = target) %>%\n  mutate(across(c(from_id, to_id),\n                as.character)) %>%\n  filter(from_id %in% mc3_nodes_cleaned$id,\n         to_id %in% mc3_nodes_cleaned$id) %>%\n  filter(!is.na(from_id), !is.na(to_id))\n```\n:::\n\n\n\nNext, code chunk below will be used to create mapping of character id in `mc3_nodes_cleaned` to row index.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnode_index_lookup <- mc3_nodes_cleaned %>%\n  mutate(.row_id = row_number()) %>%\n  select(id, .row_id)\n```\n:::\n\n\n\nNext, the code chunk below will be used to join and convert `from_id` and `to_id` to integer indices. At the same time, we will drop rows with unmatched nodes.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc3_edges_indexed <- mc3_edges_cleaned %>%\n  left_join(node_index_lookup, \n            by = c(\"from_id\" = \"id\")) %>%\n  rename(from = .row_id) %>%\n  left_join(node_index_lookup, \n            by = c(\"to_id\" = \"id\")) %>%\n  rename(to = .row_id) %>%\n  select(from, to, is_inferred, type) %>%\n  filter(!is.na(from) & !is.na(to))  \n```\n:::\n\n\n\nNext, the code chunk below is used to subset nodes to only those referenced by edges\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nused_node_indices <- sort(\n  unique(c(mc3_edges_indexed$from, \n           mc3_edges_indexed$to)))\n\nmc3_nodes_final <- mc3_nodes_cleaned %>%\n  slice(used_node_indices) %>%\n  mutate(new_index = row_number())\n```\n:::\n\n\n\nWe will then use th code chunk below to rebuild lookup from old index to new index\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nold_to_new_index <- tibble(\n  old_index = used_node_indices,\n  new_index = seq_along(\n    used_node_indices))\n```\n:::\n\n\n\nLastly, the code chunk below will be used to update edge indices to match new node table\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc3_edges_final <- mc3_edges_indexed %>%\n  left_join(old_to_new_index, \n            by = c(\"from\" = \"old_index\")) %>%\n  rename(from_new = new_index) %>%\n  left_join(old_to_new_index, \n            by = c(\"to\" = \"old_index\")) %>%\n  rename(to_new = new_index) %>%\n  select(from = from_new, to = to_new, \n         is_inferred, type)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(mc3_edges_final)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 3,226\nColumns: 4\n$ from        <int> 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3…\n$ to          <int> 1138, 357, 747, 895, 876, 888, 896, 145, 404, 876, 888, 92…\n$ is_inferred <lgl> TRUE, FALSE, TRUE, TRUE, TRUE, TRUE, TRUE, FALSE, FALSE, T…\n$ type        <chr> NA, \"sent\", NA, NA, NA, NA, NA, \"sent\", \"sent\", NA, NA, NA…\n```\n\n\n:::\n:::\n\n\n\n# Building the tidygraph object\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmc3_graph <- tbl_graph(\n  nodes = mc3_nodes_final,\n  edges = mc3_edges_final,\n  directed = TRUE\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(mc3_graph)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nClasses 'tbl_graph', 'igraph'  hidden list of 10\n $ : num 1159\n $ : logi TRUE\n $ : num [1:3226] 0 0 0 0 0 0 0 1 1 1 ...\n $ : num [1:3226] 1137 356 746 894 875 ...\n $ : NULL\n $ : NULL\n $ : NULL\n $ : NULL\n $ :List of 4\n  ..$ : num [1:3] 1 0 1\n  ..$ : Named list()\n  ..$ :List of 31\n  .. ..$ type             : chr [1:1159] \"Entity\" \"Entity\" \"Entity\" \"Entity\" ...\n  .. ..$ label            : chr [1:1159] \"Sam\" \"Kelly\" \"Nadia Conti\" \"Elise\" ...\n  .. ..$ name             : chr [1:1159] \"Sam\" \"Kelly\" \"Nadia Conti\" \"Elise\" ...\n  .. ..$ sub_type         : chr [1:1159] \"Person\" \"Person\" \"Person\" \"Person\" ...\n  .. ..$ id               : chr [1:1159] \"Sam\" \"Kelly\" \"Nadia Conti\" \"Elise\" ...\n  .. ..$ timestamp        : chr [1:1159] NA NA NA NA ...\n  .. ..$ monitoring_type  : chr [1:1159] NA NA NA NA ...\n  .. ..$ findings         : chr [1:1159] NA NA NA NA ...\n  .. ..$ content          : chr [1:1159] NA NA NA NA ...\n  .. ..$ assessment_type  : chr [1:1159] NA NA NA NA ...\n  .. ..$ results          : chr [1:1159] NA NA NA NA ...\n  .. ..$ movement_type    : chr [1:1159] NA NA NA NA ...\n  .. ..$ destination      : chr [1:1159] NA NA NA NA ...\n  .. ..$ enforcement_type : chr [1:1159] NA NA NA NA ...\n  .. ..$ outcome          : chr [1:1159] NA NA NA NA ...\n  .. ..$ activity_type    : chr [1:1159] NA NA NA NA ...\n  .. ..$ participants     : int [1:1159] NA NA NA NA NA NA NA NA NA NA ...\n  .. ..$ reference        : chr [1:1159] NA NA NA NA ...\n  .. ..$ date             : chr [1:1159] NA NA NA NA ...\n  .. ..$ time             : chr [1:1159] NA NA NA NA ...\n  .. ..$ friendship_type  : chr [1:1159] NA NA NA NA ...\n  .. ..$ permission_type  : chr [1:1159] NA NA NA NA ...\n  .. ..$ start_date       : chr [1:1159] NA NA NA NA ...\n  .. ..$ end_date         : chr [1:1159] NA NA NA NA ...\n  .. ..$ report_type      : chr [1:1159] NA NA NA NA ...\n  .. ..$ submission_date  : chr [1:1159] NA NA NA NA ...\n  .. ..$ jurisdiction_type: chr [1:1159] NA NA NA NA ...\n  .. ..$ authority_level  : chr [1:1159] NA NA NA NA ...\n  .. ..$ coordination_type: chr [1:1159] NA NA NA NA ...\n  .. ..$ operational_role : chr [1:1159] NA NA NA NA ...\n  .. ..$ new_index        : int [1:1159] 1 2 3 4 5 6 7 8 9 10 ...\n  ..$ :List of 2\n  .. ..$ is_inferred: logi [1:3226] TRUE FALSE TRUE TRUE TRUE TRUE ...\n  .. ..$ type       : chr [1:3226] NA \"sent\" NA NA ...\n $ :<environment: 0x000001b6e402da80> \n - attr(*, \"active\")= chr \"nodes\"\n```\n\n\n:::\n:::\n\n\n\n# Visualising the knowledge graph\n\nSeveral of the ggraph layouts involve randomisation. In order to ensure reproducibility, it is necessary to set the seed value before plotting by using the code chunk below.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234)\n```\n:::\n\n\n\nIn the code chunk below, ggraph fundtions are used to create the whole graph\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggraph(mc3_graph, \n       layout = \"fr\") +\n  geom_edge_link(alpha = 0.3, \n                 colour = \"gray\") +\n  geom_node_point(aes(color = `type`), \n                  size = 4) +\n  geom_node_text(aes(label = type), \n                 repel = TRUE, \n                 size = 1.0) +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n\n# Question 1\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(lubridate)   # date‐time parsing\nlibrary(tidyverse)   # data manipulation & ggplot2\n\n# 1. Extract timestamp of each Communication event\ncomm_times <- mc3_graph %>%\n  activate(\"nodes\") %>%\n  as_tibble() %>%\n  filter(type==\"Event\", sub_type==\"Communication\") %>%\n  select(id, timestamp) %>%\n  mutate(\n    dt   = ymd_hms(timestamp),         # full POSIX\n    day  = as_date(dt),                # calendar date\n    hour = hour(dt)                    # hour of day\n  )\n\n# 2. Count per day/hour\nheat <- comm_times %>%\n  count(day, hour)\n\n# 3. Plot heatmap\nggplot(heat, aes(x = day, y = hour, fill = n)) +\n  geom_tile(color=\"white\") +\n  scale_fill_viridis_c(name=\"Messages\") +\n  scale_y_continuous(breaks=0:23) +\n  labs(\n    title = \"Communications by Day and Hour\",\n    subtitle = \"Two‐week window\",\n    x = \"Date\", y = \"Hour of Day\"\n  ) +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle=45, hjust=1))\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/viz1-comm-heatmap-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# 1. Re‐use comm_times from Viz 1\ndaily_trend <- comm_times %>%\n  count(day)\n\n# 2. Plot line chart\nggplot(daily_trend, aes(x = day, y = n)) +\n  geom_line(size=1) +\n  geom_point(size=2) +\n  labs(\n    title = \"Daily Communication Volume\",\n    x = \"Date\", y = \"Number of Messages\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# ─────────────────────────────────────────────────────────────────────────────\n# Visualization 1.1: Bar chart of the top 20 words in Communication events\n# ─────────────────────────────────────────────────────────────────────────────\nlibrary(tidyverse)    # dplyr, ggplot2\nlibrary(tidytext)     # unnest_tokens, stop_words\n\n# 1. Extract all Communication event texts\ncomms <- mc3_graph %>% \n  activate(\"nodes\") %>% \n  as_tibble() %>% \n  filter(type == \"Event\", sub_type == \"Communication\") %>% \n  select(content)      # just keep the text column\n\n# 2. Tokenize into individual words (lowercased)\nwords <- comms %>% \n  unnest_tokens(word, content)\n\n# 3. Remove English stop-words (a, the, is, etc.)\ndata(\"stop_words\")    # from tidytext\nclean_words <- words %>% \n  anti_join(stop_words, by = \"word\")\n\n# 4. Count and keep the top 20 most frequent words\ntop20 <- clean_words %>% \n  count(word, sort = TRUE) %>% \n  slice_max(n, n = 20)\n\n# 5. Plot as a horizontal bar chart\nggplot(top20, aes(x = reorder(word, n), y = n)) +\n  geom_col(fill = \"steelblue\") +\n  coord_flip() +\n  labs(\n    title = \"Top 20 Words in Communication Events\",\n    x = \"Word\",\n    y = \"Count\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/top20-communication-words-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(tidygraph)\nlibrary(ggraph)\nlibrary(igraph)     # for arrow() helper\nlibrary(grid)       # for unit()\n\n# 1. select only the nodes we care about\nselected_nodes <- mc3_nodes_final %>%\n  filter(\n    (type == \"Entity\"     & sub_type %in% c(\"Person\", \"Vessel\")) |\n    (type == \"Event\"      & sub_type == \"Communication\")      |\n    (type == \"Relationship\")\n  ) %>%\n  mutate(idx = row_number())  # new index in the filtered graph\n\n# mapping old_index → new idx\nid_map <- selected_nodes %>%\n  select(old = new_index, new = idx)\n\n# 2. filter edges so both ends are in selected_nodes\nselected_edges <- mc3_edges_final %>%\n  filter(from %in% id_map$old, to %in% id_map$old) %>%\n  # 3. re-index the endpoints\n  left_join(id_map, by = c(\"from\" = \"old\")) %>%\n  rename(from_new = new) %>%\n  left_join(id_map, by = c(\"to\"   = \"old\")) %>%\n  rename(to_new   = new) %>%\n  select(from = from_new, to = to_new, type)\n\n# 4. rebuild and plot\nfiltered_graph <- tbl_graph(\n  nodes    = selected_nodes,\n  edges    = selected_edges,\n  directed = TRUE\n)\n\nset.seed(1234)\nggraph(filtered_graph, layout = \"fr\") +\n  geom_edge_link(\n    aes(color = type),\n    arrow    = arrow(length = unit(3, \"mm\")),\n    end_cap  = circle(2, \"mm\"),\n    alpha    = 0.6\n  ) +\n  geom_node_point(aes(color = sub_type), size = 4) +\n  geom_node_text(aes(label = label), repel = TRUE, size = 3) +\n  scale_edge_color_brewer(palette = \"Dark2\") +\n  scale_color_manual(\n    values = c(Person = \"#1b9e77\", Vessel = \"#d95f02\", Communication = \"#7570b3\", Relationship = \"#e7298a\")\n  ) +\n  theme_void() +\n  theme(legend.position = \"right\")\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/mc3_filtered_network-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(tidygraph)\nlibrary(ggraph)\nlibrary(igraph)\nlibrary(grid)\nlibrary(lubridate)\nlibrary(purrr)\nlibrary(patchwork)\n\n# assume selected_nodes and selected_edges have been defined earlier\n\ndaily_comms <- selected_nodes %>%\n  filter(type == \"Event\", sub_type == \"Communication\") %>%\n  mutate(date = as_date(timestamp)) %>%\n  select(idx, date)\n\nall_dates <- sort(unique(daily_comms$date)) %>% discard(is.na)\n\nplots <- map(all_dates, function(d) {\n  comm_idx <- daily_comms %>% filter(date == d) %>% pull(idx)\n  edges_d  <- selected_edges %>%\n    filter(from %in% comm_idx | to %in% comm_idx)\n  if (nrow(edges_d) == 0) return(NULL)\n\n  keep_idx <- unique(c(edges_d$from, edges_d$to))\n  nodes_d  <- selected_nodes %>% filter(idx %in% keep_idx)\n\n  node_map <- tibble(old = nodes_d$idx, new = seq_len(nrow(nodes_d)))\n  edges_d2 <- edges_d %>%\n    left_join(node_map, by = c(\"from\" = \"old\")) %>% mutate(from = new) %>% select(-new) %>%\n    left_join(node_map, by = c(\"to\"   = \"old\")) %>% mutate(to   = new) %>% select(-new)\n  nodes_d2 <- nodes_d %>% mutate(idx2 = seq_len(nrow(nodes_d)))\n\n  g_d <- tbl_graph(nodes = nodes_d2, edges = edges_d2, directed = TRUE)\n  lay <- create_layout(g_d, layout = \"fr\", niter = 500,\n                       area = vcount(g_d)^2, repulse = vcount(g_d)^1.2)\n\n  ggraph(lay) +\n    geom_edge_link(aes(color = type),\n                   arrow = arrow(length = unit(2, \"mm\")),\n                   lineend = \"butt\",\n                   alpha = 0.4,\n                   width = 1,\n                   show.legend = TRUE) +\n\n    geom_node_point(aes(color = sub_type),\n                    size = 4,\n                    show.legend = TRUE) +\n    geom_node_text(aes(label = ifelse(sub_type %in% c(\"Person\",\"Vessel\"), label, \"\")),\n                   repel = TRUE,\n                   point.padding = unit(0.2, \"lines\"),\n                   box.padding = unit(0.2, \"lines\"),\n                   size = 4) +\n    scale_edge_color_brewer(name = \"Edge Type\", palette = \"Dark2\", guide = guide_legend()) +\n    scale_color_manual(name = \"Node Sub-type\",\n                       values = c(\n                         Person        = \"#1b9e77\",\n                         Vessel        = \"#d95f02\",\n                         Communication = \"#7570b3\",\n                         Relationship  = \"#e7298a\"\n                       ),\n                       guide = guide_legend()) +\n    ggtitle(as.character(d)) +\n    theme_void() +\n    theme(\n      plot.title  = element_text(size = 8, hjust = 0.5),\n      plot.margin = margin(2,2,2,2)\n    )\n})\n\nwrap_plots(plots, ncol = 2) +\n  plot_layout(guides = \"collect\") +\n  plot_annotation(title = \"MC3 Communications by Day\") &\n  theme(\n    legend.position = \"right\",\n    legend.title    = element_text(size = 10),\n    legend.text     = element_text(size = 8)\n  )\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/mc3_daily_networks_fixed-1.png){width=1152}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(tidygraph)\nlibrary(ggraph)\nlibrary(igraph)\nlibrary(grid)\nlibrary(lubridate)\nlibrary(purrr)\nlibrary(patchwork)\n\n# assume selected_nodes and selected_edges have been defined earlier\n\ndaily_comms <- selected_nodes %>%\n  filter(type == \"Event\", sub_type == \"Communication\") %>%\n  mutate(date = as_date(timestamp)) %>%\n  select(idx, date)\n\nall_dates <- sort(unique(daily_comms$date)) %>% discard(is.na)\n\nplots <- map(all_dates, function(d) {\n  comm_idx <- daily_comms %>% filter(date == d) %>% pull(idx)\n  edges_d  <- selected_edges %>%\n    filter(from %in% comm_idx | to %in% comm_idx)\n  if (nrow(edges_d) == 0) return(NULL)\n\n  keep_idx <- unique(c(edges_d$from, edges_d$to))\n  nodes_d  <- selected_nodes %>% filter(idx %in% keep_idx)\n\n  node_map <- tibble(old = nodes_d$idx, new = seq_len(nrow(nodes_d)))\n  edges_d2 <- edges_d %>%\n    left_join(node_map, by = c(\"from\" = \"old\")) %>% mutate(from = new) %>% select(-new) %>%\n    left_join(node_map, by = c(\"to\"   = \"old\")) %>% mutate(to   = new) %>% select(-new)\n  nodes_d2 <- nodes_d %>% mutate(idx2 = seq_len(nrow(nodes_d)))\n\n  g_d <- tbl_graph(nodes = nodes_d2, edges = edges_d2, directed = TRUE)\n  lay <- create_layout(g_d, layout = \"fr\", niter = 500,\n                       area = vcount(g_d)^2, repulse = vcount(g_d)^1.2)\n\n  ggraph(lay) +\n    geom_edge_link(aes(color = type),\n                   arrow = arrow(length = unit(2, \"mm\")),\n                   end_cap = circle(1.5, \"mm\"),\n                   alpha = 0.4,\n                   width = 1,\n                   show.legend = TRUE) +\n    geom_node_point(aes(color = sub_type),\n                    size = 4,\n                    show.legend = TRUE) +\n    geom_node_text(aes(label = ifelse(sub_type %in% c(\"Person\",\"Vessel\"), label, \"\")),\n                   repel = TRUE,\n                   point.padding = unit(0.2, \"lines\"),\n                   box.padding = unit(0.2, \"lines\"),\n                   size = 4) +\n    scale_edge_color_brewer(name = \"Edge Type\", palette = \"Dark2\", guide = guide_legend()) +\n    scale_color_manual(name = \"Node Sub-type\",\n                       values = c(\n                         Person        = \"#1b9e77\",\n                         Vessel        = \"#d95f02\",\n                         Communication = \"#7570b3\",\n                         Relationship  = \"#e7298a\"\n                       ),\n                       guide = guide_legend()) +\n    ggtitle(as.character(d)) +\n    theme_void() +\n    theme(\n      plot.title  = element_text(size = 8, hjust = 0.5),\n      plot.margin = margin(2,2,2,2)\n    )\n})\n\nwrap_plots(plots, ncol = 2) +\n  plot_layout(guides = \"collect\") +\n  plot_annotation(title = \"MC3 Communications by Day\") &\n  theme(\n    legend.position = \"right\",\n    legend.title    = element_text(size = 10),\n    legend.text     = element_text(size = 8)\n  )\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/mc3_daily_networks_try-1.png){width=1152}\n:::\n:::\n\n\n\n```{# {r mc3_daily_networks, message=FALSE, warning=FALSE, fig.width=12, fig.height=26}\n# library(dplyr)\n# library(tidygraph)\n# library(ggraph)\n# library(igraph)\n# library(grid)\n# library(lubridate)\n# library(purrr)\n# library(patchwork)\n# \n# # — assume selected_nodes, selected_edges have been defined earlier —\n# \n# daily_comms <- selected_nodes %>%\n#   filter(type == \"Event\", sub_type == \"Communication\") %>%\n#   mutate(date = as_date(timestamp)) %>%\n#   select(idx, date)\n# \n# all_dates <- sort(unique(daily_comms$date)) %>% discard(is.na)\n# \n# plots <- map(all_dates, function(d) {\n#   comm_idx <- daily_comms %>% filter(date == d) %>% pull(idx)\n#   edges_d  <- selected_edges %>%\n#     filter(from %in% comm_idx | to %in% comm_idx)\n# \n#   if (nrow(edges_d) == 0) return(NULL)\n# \n#   # pick nodes touching those edges\n#   keep_idx <- unique(c(edges_d$from, edges_d$to))\n#   nodes_d   <- selected_nodes %>% filter(idx %in% keep_idx)\n# \n#   # re‐index: build a node_map old→new\n#   node_map <- tibble(old = nodes_d$idx,\n#                      new = seq_len(nrow(nodes_d)))\n# \n#   # **FIXED**: overwrite from/to via mutate + drop the helper column\n#   edges_d2 <- edges_d %>%\n#     left_join(node_map, by = c(\"from\" = \"old\")) %>%\n#     mutate(from = new) %>%\n#     select(-new) %>%\n#     left_join(node_map, by = c(\"to\" = \"old\")) %>%\n#     mutate(to = new) %>%\n#     select(-new)\n# \n#   nodes_d2 <- nodes_d %>%\n#     mutate(idx2 = seq_len(nrow(nodes_d)))  # optional\n# \n#   # build the subgraph\n#   g_d <- tbl_graph(nodes = nodes_d2, edges = edges_d2, directed = TRUE)\n# \n#   # FR layout\n#   lay <- create_layout(g_d, layout = \"fr\", niter = 500,\n#                        area = vcount(g_d)^2, repulse = vcount(g_d)^1.2)\n# \n#   # plot\n#   ggraph(lay) +\n#     geom_edge_link(aes(color = type),\n#                    arrow   = arrow(length = unit(2, \"mm\")),\n#                    end_cap = circle(1.5, \"mm\"),\n#                    alpha   = 0.4, width = 0.3) +\n#     geom_node_point(aes(color = sub_type), size = 2.5) +\n#     geom_node_text(aes(label = ifelse(sub_type %in% c(\"Person\",\"Vessel\"), label, \"\")),\n#                    repel         = TRUE,\n#                    point.padding = unit(0.2, \"lines\"),\n#                    box.padding   = unit(0.2, \"lines\"),\n#                    size          = 2) +\n#     scale_edge_color_brewer(palette = \"Dark2\") +\n#     scale_color_manual(values = c(\n#       Person        = \"#1b9e77\",\n#       Vessel        = \"#d95f02\",\n#       Communication = \"#7570b3\",\n#       Relationship  = \"#e7298a\"\n#     )) +\n#     ggtitle(as.character(d)) +\n#     theme_void() +\n#     theme(\n#       legend.position = \"right\",\n#       plot.title      = element_text(size = 8, hjust = 0.5),\n#       plot.margin     = margin(2,2,2,2)\n#     )\n# })\n# \n# wrap_plots(compact(plots), ncol = 7) & \n#   plot_annotation(title = \"MC3 Communications by Day\")\n# \n#   # sub‐graph\n#   g_d <- tbl_graph(nodes = nodes_d, edges = edges_d, directed = TRUE)\n#   \n#   # FR layout (reuse same seed so all days “look” similar)\n#   lay <- create_layout(g_d, layout = \"fr\", niter = 500,\n#                        area = vcount(g_d)^2, repulse = vcount(g_d)^1.2)\n#   \n#   # plot\n#   ggraph(lay) +\n#     geom_edge_link(aes(color = type),\n#                    arrow   = arrow(length = unit(2, \"mm\")),\n#                    end_cap = circle(1.5, \"mm\"),\n#                    alpha   = 0.4,\n#                    width   = 0.3) +\n#     geom_node_point(aes(color = sub_type), size = 2.5) +\n#     # only label Persons/Vessels\n#     geom_node_text(aes(label = ifelse(sub_type %in% c(\"Person\",\"Vessel\"), label, \"\")),\n#                    repel         = TRUE,\n#                    point.padding = unit(0.2, \"lines\"),\n#                    box.padding   = unit(0.2, \"lines\"),\n#                    size          = 2) +\n#     scale_edge_color_brewer(palette = \"Dark2\") +\n#     scale_color_manual(values = c(\n#       Person        = \"#1b9e77\",\n#       Vessel        = \"#d95f02\",\n#       Communication = \"#7570b3\",\n#       Relationship  = \"#e7298a\"\n#     )) +\n#     ggtitle(as.character(d)) +\n#     theme_void() +\n#     theme(\n#       legend.position = \"right\",\n#       plot.title      = element_text(size = 8, hjust = 0.5),\n#       plot.margin     = margin(2,2,2,2)\n#     )\n# \n# # 3. stitch them into a grid — e.g. 7 days across\n# wrap_plots(plots, ncol = 2) & \n#   plot_annotation(title = \"MC3 Communications by Day\")\n\n```\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(tidygraph)\nlibrary(ggraph)\nlibrary(igraph)\nlibrary(grid)\nlibrary(lubridate)\nlibrary(purrr)\nlibrary(patchwork)\n\n# — assume selected_nodes and selected_edges have been defined earlier —\n\ndaily_comms <- selected_nodes %>%\n  filter(type == \"Event\", sub_type == \"Communication\") %>%\n  mutate(date = as_date(timestamp)) %>%\n  select(idx, date)\n\nall_dates <- sort(unique(daily_comms$date)) %>% discard(is.na)\n\nplots <- map(all_dates, function(d) {\n  comm_idx <- daily_comms %>% filter(date == d) %>% pull(idx)\n  edges_d  <- selected_edges %>%\n    filter(from %in% comm_idx | to %in% comm_idx)\n\n  if (nrow(edges_d) == 0) return(NULL)\n\n  # pick nodes touching those edges\n  keep_idx <- unique(c(edges_d$from, edges_d$to))\n  nodes_d   <- selected_nodes %>% filter(idx %in% keep_idx)\n\n  # re-index: build a node_map old→new\n  node_map <- tibble(old = nodes_d$idx,\n                     new = seq_len(nrow(nodes_d)))\n\n  edges_d2 <- edges_d %>%\n    left_join(node_map, by = c(\"from\" = \"old\")) %>%\n    mutate(from = new) %>% select(-new) %>%\n    left_join(node_map, by = c(\"to\" = \"old\")) %>%\n    mutate(to = new) %>% select(-new)\n\n  nodes_d2 <- nodes_d %>% mutate(idx2 = seq_len(nrow(nodes_d)))\n\n  # build the subgraph\n  g_d <- tbl_graph(nodes = nodes_d2, edges = edges_d2, directed = TRUE)\n\n  # FR layout\n  lay <- create_layout(g_d, layout = \"fr\", niter = 500,\n                       area = vcount(g_d)^2, repulse = vcount(g_d)^1.2)\n\n  # plot\n  ggraph(lay) +\n    geom_edge_link(aes(color = type),\n                   arrow = arrow(length = unit(2, \"mm\")),\n                   lineend = \"butt\",\n                   alpha = 0.4,\n                   width = 2) +          # thicker arrows\n    geom_node_point(aes(color = sub_type), size = 8) +\n    geom_node_text(aes(label = ifelse(sub_type %in% c(\"Person\",\"Vessel\"), label, \"\")),\n                   repel = TRUE,\n                   point.padding = unit(0.5, \"lines\"),\n                   box.padding   = unit(0.5, \"lines\"),\n                   size = 6) +\n    scale_edge_color_manual(name = \"Edge Type\",\n                            values = c(\n                              evidence_for = \"#1B9E77\",\n                              received     = \"#D95F02\",\n                              sent         = \"#7570B3\",\n                              \"NA\"           = \"#999999\"\n                            ),\n                            guide = guide_legend(override.aes = list(\n                              linetype = 1,\n                              shape    = NA,\n                              size     = 1\n                            ))) +\n    scale_color_manual(name = \"Node Sub-type\",\n                       values = c(\n                         Person        = \"#1b9e77\",\n                         Vessel        = \"#d95f02\",\n                         Communication = \"#7570b3\",\n                         Relationship  = \"#e7298a\"\n                       )) +\n    ggtitle(as.character(d)) +\n    theme_void() +\n    theme(\n      plot.title      = element_text(size = 12, hjust = 0.5),\n      plot.margin     = margin(2,2,2,2),\n      legend.position = \"right\"\n    )\n})\n\n# Combine all daily plots into a 2-column grid with one shared legend\nwrap_plots(plots, ncol = 2) +\n  plot_layout(guides = \"collect\") +\n  plot_annotation(title = \"MC3 Communications by Day\")\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex02_files/figure-html/mc3_daily_networks_tryagain-1.png){width=1536}\n:::\n:::\n",
    "supporting": [
      "Take-Home_Ex02_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}