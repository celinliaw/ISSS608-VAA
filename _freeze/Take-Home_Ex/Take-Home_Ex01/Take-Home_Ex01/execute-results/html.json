{
  "hash": "5b6e889a1b9ad619b8b1b5b38c6a02f7",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take-Home Exercise 1: Creating Data Visualisation that is enlightening and truthful\"\ndate: 1 May 2025\ndate-modified: \"last-modified\"\nauthor: \"Liaw Ying Ting, Celin\"\nexecute: \n  eval: true\n  echo: true\n  warning: false\n  freeze: true\n---\n\n\n\n# 1. Overview\n\n## 1.1 Setting the scene\n\nA local online media company that publishes daily content on digital platforms is planning to release an article on demographic structures and distribution of Singapore in 2024\n\n## 1.2 The Task\n\nAssuming the role of the graphical editor of the media company, you are tasked to prepare at most three data visualisation for the article.\n\nTo accomplish the task, the data: *Singapore Residents by Planning Area/Subzone, Single Year of Age and Sex, June 2024* dataset shared by [Department of Statistics, Singapore(DOS)](https://www.singstat.gov.sg/find-data/search-by-theme/population/geographic-distribution/latest-data) is used.\n\n## 1.3 Breaking down the question\n\nDemographic Structure refers to: Age distribution, Gender Ratio and Dependency Ratio (Elderly per working adult)\n\nDemographic Distribution refers to: Planning Area or Subzone, Urban vs Suburban, Age or gender concentrations in specific areas\n\nBased on these information, i plan to answer the following questions:\n\n-   What is the age distribution of Singapore's population in 2024 and what is the proportion of working proportion\n\n# 2. Getting Started\n\n## 2.1 Load packages\n\nWe load the following packages using the <code style=\"color: blue;\">pacman::p_load</code> function:\n\n-   **tidyverse:** Core collection of R packages designed for data science\n\n-   **ggrepel:** An R package to provide geoms for gg plot2 to repel overlapping text labels\n\n-   **ggthemes:** An R package to provided extra themes, geoms and scales for ggplot 2\n\n-   **hrbrthemes:** an R packagae that provides typography-centric themes and theme componenets for ggplot2\n\n-   **patchwork:** to prepare composite figure created using ggplot2\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tidyverse, ggrepel, \n               ggthemes,  hrbrthemes,\n               patchwork,\n               dplyr, forcats) \n```\n:::\n\n\n\n## 2.2 Import Data\n\nThe data that has been used has been mentioned in Chapter 1.2 above. We import this dataset as *resident_data.*\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresident_data <- read_csv(\"respopagesex2024.csv\")\n```\n:::\n\n\n\n## 2.3 Data Wrangling\n\n### 2.3.1 Check for duplicate entries\n\nWe first take a look at the data and check if there are any duplicate entries using <code style=\"color: blue;\">any(duplicated())</code>.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nany(duplicated(resident_data))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] FALSE\n```\n\n\n:::\n:::\n\n\n\nSince \"FALSE\" is returned, there are no duplicated entries\n\n### 2.3.2 Check for missing values\n\nThe <code style=\"color: blue;\">colSums</code> function is being used to check for missing values.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncolSums(is.na(resident_data))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  PA   SZ  Age  Sex  Pop Time \n   0    0    0    0    0    0 \n```\n\n\n:::\n:::\n\n\n\nSince there are no missing values in any of the rows, we will proceed with the next step.\n\n### 2.3.3 Filtering for relevant variables & renaming them\n\nThere are 60424 rows x 6 columns in the data, where the columns are labelled as:\n\n-   **PA** - Planning Area\n\n-   **SZ** - Subzone\n\n-   **Age** - From \"0\" to \"89\", and those above 90 are labelled as \"90_and_Over\"\n\n-   **Sex** - Males or Females\n\n-   **Pop** - Resident Count (Has been rounded to the nearest 10)\n\n-   **Time** - Year (We will only be looking at 2024 data)\n\nCreate a new object called **resident_data_clean** where we will rename **PA, SZ** and **Pop** for easy reading by using the <code style=\"color: blue;\">rename()</code> function.\n\nRename those labelled as \"90_and_Over\" in the Age Column as \"90\" using the <code style=\"color: blue;\">ifelse()</code> function for easier data plots.\n\nEnsuring population and age is categorised as numerical data by using the <code style=\"color: blue;\">as.numeric</code> function.\n\nFor the Age column, it is slightly special as I used <code style=\"color: blue;\">levels = as.character</code> function as R sorts alphabetically by default and \"10\" will come before \"2\" instead. But by using this function, i am forcing R to treat the ages in true numeric order when i plot or tabulate them. A new column, **Age_numeric**, is also created in the new object.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresident_data_clean <- resident_data %>%\n  rename(\n    Planning_Area = PA,\n    Subzone = SZ,\n    Population = Pop\n  ) %>%\n  # Convert Age to \"90+\" if it's \"90_and_Over\"\n  mutate(\n    Age = ifelse(Age == \"90_and_Over\", \"90\", Age),\n    Population = as.numeric(Population),\n    Age = factor(Age, levels = as.character(0:90)),\n    Age_numeric = as.numeric(as.character(Age))  \n  )\n```\n:::\n\n\n\n2.3.4 Preview processed data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(resident_data_clean)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 7\n  Planning_Area Subzone                Age   Sex    Population  Time Age_numeric\n  <chr>         <chr>                  <fct> <chr>       <dbl> <dbl>       <dbl>\n1 Ang Mo Kio    Ang Mo Kio Town Centre 0     Males          10  2024           0\n2 Ang Mo Kio    Ang Mo Kio Town Centre 0     Femal…         10  2024           0\n3 Ang Mo Kio    Ang Mo Kio Town Centre 1     Males          10  2024           1\n4 Ang Mo Kio    Ang Mo Kio Town Centre 1     Femal…         10  2024           1\n5 Ang Mo Kio    Ang Mo Kio Town Centre 2     Males          10  2024           2\n6 Ang Mo Kio    Ang Mo Kio Town Centre 2     Femal…         10  2024           2\n```\n\n\n:::\n:::\n\n\n\nNow that data wrangling is complete, we will proceed to share 3 key visualisations performed on this data set.\n\n# 3 Data Visualisation\n\nAs there are too many planning areas, to make things easier to visualise, I categorised them into 5 areas: North, North-East, East, West and Central. This is done by using the categories on the [Urban Redevelopment Authority(URA)](https://eservice.ura.gov.sg/maps/?service=MP) website:\n\n-   **North**: Central Water Catchment, Lim Chu Kang, Mandai, Sembawang, Simpang, Sungei Kadut, Woodlands, Yishun\n\n-   **North-East**: Ang Mo Kio, Hougang, Punggol, Sengkang, Serangoon, Seletar\n\n-   **East**: Bedok, Changi, Changi Bay, Pasir Ris, Paya Lebar, Tampines\n\n-   **West**: Boon Lay, Bukit Batok, Bukit Panjang, Choa Chu Kang, Clementi, Jurong East, Jurong West, Pioneer, Tengah, Tuas, Western Water Cachement\n\n-   **Central**: Bishan, Bukit Merah, Bukit Timah, Central Area, Downtown Core, Marina East, Marina South, Museum, Newton, Novena, Orchard, Outram, River Valley, Rochor, Singapore River, Straits View, Tanglin\n\n    Areas like **North-Eastern Islands** and **Western islands** are intentionally left out as they do not belong to any of the areas\n\nSteps:\n\nStep 1: I first created a new list called **region_map** to categorise them into the 5 categories\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 1. Step 1\nregion_map <- list(\n  North = c(\n    \"Central Water Catchment\", \"Lim Chu Kang\", \"Mandai\",\n    \"Sembawang\", \"Simpang\", \"Sungei Kadut\", \"Woodlands\", \"Yishun\"\n  ),\n  `North-East` = c(\n    \"Ang Mo Kio\", \"Hougang\", \"Punggol\", \"Sengkang\", \n    \"Serangoon\", \"Seletar\"\n  ),\n  East = c(\n    \"Bedok\", \"Changi\", \"Changi Bay\", \n    \"Pasir Ris\", \"Paya Lebar\", \"Tampines\"\n  ),\n  West = c(\n    \"Boon Lay\", \"Bukit Batok\", \"Bukit Panjang\", \"Choa Chu Kang\",\n    \"Clementi\", \"Jurong East\", \"Jurong West\", \"Pioneer\", \n    \"Tengah\", \"Tuas\", \"Western Water Catchment\"\n  ),\n  Central = c(\n    \"Bishan\", \"Bukit Merah\", \"Bukit Timah\", \"Central Area\",\n    \"Downtown Core\", \"Marina East\", \"Marina South\", \"Museum\",\n    \"Newton\", \"Novena\", \"Orchard\", \"Outram\", \"River Valley\",\n    \"Rochor\", \"Singapore River\", \"Straits View\", \"Tanglin\"\n  )\n)\n```\n:::\n\n\n\nStep 2: A new data object **resident_regioned** was then created with their region matched to them and those who are not found are removed using <code style=\"color: blue;\">filter()</code> function.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Step 2\nresident_regioned <- resident_data_clean %>%\n  mutate(\n    Region = case_when(\n      Planning_Area %in% region_map$North        ~ \"North\",\n      Planning_Area %in% region_map$`North-East` ~ \"North-East\",\n      Planning_Area %in% region_map$East         ~ \"East\",\n      Planning_Area %in% region_map$West         ~ \"West\",\n      Planning_Area %in% region_map$Central      ~ \"Central\",\n      TRUE                                       ~ NA_character_\n    )\n  ) %>%\n  filter(!is.na(Region))\n```\n:::\n\n\n\nThis will enable me to group them into their respective regions for the analysis.\n\n## 3.1 Pie Chart By Regions\n\nFirst, i create groups using <code style=\"color: blue;\">groupby()</code> to group them by regions and sex (Eg. East Males and East Females) so that i can get the total number of each group using <code style=\"color: blue;\">sum()</code>. After that, <code style=\"color: blue;\">.groups = \"drop\"</code> will remove the groups as ggplot doesn't use groupings to plot and some functions that \"mutate\" may not turn out as expected.\n\nNext, <code style=\"color: blue;\">ordered_levels</code> is created to define the stacking order for the pie slices in a clockwise direction.\n\n\n::: panel-tabset\n### The Plot\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Take-Home_Ex01_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\n### The Code\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Take-Home_Ex01_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n:::\n\nFrom the pie chart, it can be seen that the **proportion of males and females in each area is quite similar**, only differing by 1-2%. However, it can be seen from the pie chart that the proportion of **males are consistently lesser** that the proportion of females in each area. We can then conclude that there are **slightly less males that females in Singapore**.\n\nAdditionally, the **West and North-East Areas each made up 25%** of the total population, accounting for half the population in Singapore while the North, Central and and East made up of the other half of Singapore's population.\n\n## 3.2 Age Sex Pyramid by Regions\n\nThe data was then mutated using <code style=\"color: blue;\">cut()</code> and <code style=\"color: blue;\">breaks()</code> function to split them into Age categories: \"0-9\", \"10-19\" and so on. In the <code style=\"color: blue;\">cut()</code> function, \"right = FALSE\" was used to exclude the upper bound of the bins so that they will consider 0-9 instead of 0-10 for each bin. A new column **Age_bin** was created.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Step 3\nresident_regioned <- resident_regioned %>%\n  mutate(\n    Age_bin = cut(\n      Age_numeric,\n      breaks = c(seq(0, 90, by = 10), Inf),\n      labels = c(paste0(seq(0,80,by=10), \"-\", seq(9,89,by=10)), \"90 and Above\"),\n      right = FALSE\n    )\n  )\n```\n:::\n\n\n\nA new data object **pyramid_data** was created to create the pyramid table. <code style=\"color: blue;\">groupby()</code> and <code style=\"color: blue;\">summarise(Total = sum())</code> functions were used to group them by region(East, West etc), age group(Eg. 0-9, 10-19 etc) and sex(Males or females), before summing them up.\n\n<code style=\"color: blue;\">Value = ifelse(Sex == \"Males, -Total, Total\")</code> was then used to flip males to negative values so they will be plotted to the left, while the female values remain as positive.\n\n<code style=\"color: blue;\">Label = format(Total, big.mark = \",\")</code> is used to convert the numbers from 52300 to 52,300. These labels will be shown beside the bar graph.\n\n<code style=\"color: blue;\">hjust = ifelse(Sex == \"Males\", 1.1, -0.1)</code> aligns the male label to the left of the graph and aligns the female label to the right of the graph.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Step 4: Prepare pyramid data for static chart\npyramid_data <- resident_regioned %>%\n  group_by(Region, Age_bin, Sex) %>%\n  summarise(Total = sum(Population), .groups = \"drop\") %>%\n  mutate(\n    Value = ifelse(Sex == \"Males\", -Total, Total),\n    Label = format(Total, big.mark = \",\"),\n    hjust = ifelse(Sex == \"Males\", 1.1, -0.1)  # push left or right based on sex\n  )\n```\n:::\n\n\n\nIn this section, I will be plotting individual plots and putting them together with <code style=\"color: blue;\">patchwork</code>.\n\nFirst, i created a reusable function called <code style=\"color: blue;\">plot_region_pyramid</code> so that i am able to call it by its region name.\n\n<code style=\"color: blue;\">ggplot</code> is then used next to plot the graph. <code style=\"color: blue;\">aes( x = Value, y = Age_bin, fill = Sex)</code> uses x-axis as Values so that Males are negative and Females are positive, y-axis is using the <code style=\"color: blue;\">Age_bin</code> which was created previously ranging from \"0-9\", \"10-19\" etc and fill is coloured by the different Sex.\n\n<code style=\"color: blue;\">geom_col(width = 0.8)</code> makes the width slightly smaller than 1 so that they do not touch.\n\n<code style=\"color: blue;\">geom_text(aes(label = Label, hjust = hjust), size = 2.8, color = \"black\")</code> is an aesthetic label that uses the pre-formatted functions in the code chunk before this.\n\n<code style=\"color: blue;\">scale_x_continuous()</code> helps to adjust the labels of the axis to follow pre-defined values that i mentioned in the code\n\n<code style=\"color: blue;\">coord_cartesian()</code> adjusts the actual values of the axis.\n\n<code style=\"color: blue;\">scale_fill_manual</code> sets the fill colour for males and females.\n\n<code style=\"color: blue;\">labs()</code> add a title for each pane with the region name.\n\n<code style=\"color: blue;\">theme_minimal()</code> uses the minimal theme.\n\n<code style=\"color: blue;\">(p1 / p2 / p3 / p4 / p5) + plot_layout(guides = \"collect\")</code> helps to put the graphs together and show only 1 legend.\n\n::: panel-tabset\n### The plot\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Take-Home_Ex01_files/figure-html/unnamed-chunk-13-1.png){width=768}\n:::\n:::\n\n\n\n### The code\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_region_pyramid <- function(region_name) {\n  ggplot(\n    data = filter(pyramid_data, Region == region_name),\n    aes(x = Value, y = Age_bin, fill = Sex)\n  ) +\n    geom_col(width = 0.8) +\n    geom_text(aes(label = Label, hjust = hjust), size = 2.8, color = \"black\") +\n    scale_x_continuous(\n      breaks = c(-75000, -50000, -25000, 0, 25000, 50000, 75000),\n      labels = function(x) paste0(abs(x) / 1000, \"K\")\n    ) +\n    coord_cartesian(xlim = c(-85000, 85000)) +\n    scale_fill_manual(values = c(Males = \"#4472C4\", Females = \"#ED7D31\")) +\n    labs(\n      title = paste(\"Region:\", region_name),\n      x = \"Population\",\n      y = \"Age Group\"\n    ) +\n    theme_minimal(base_size = 9) +\n    theme(\n      legend.position = \"none\",\n      strip.text = element_text(face = \"bold\"),\n      axis.title.y = element_blank(),\n      panel.grid.minor.x = element_blank(),\n      panel.grid.major.x = element_line(color = \"grey80\")\n    )\n}\n\n# Generate plots for each region\np1 <- plot_region_pyramid(\"Central\")\np2 <- plot_region_pyramid(\"East\")\np3 <- plot_region_pyramid(\"North\")\np4 <- plot_region_pyramid(\"North-East\")\np5 <- plot_region_pyramid(\"West\")\n\n# Arrange using patchwork (2 columns)\n(p1 / p2 / p3 / p4 / p5) + plot_layout(guides = \"collect\")\n```\n:::\n\n\n:::\n\nFrom the graphs, it can be seen that the population of **Ages** **30 to 69** are consistently larger than the population of **Ages** **0 to 29** in most areas, proving that there are lower birth rates in the recent years.\n\n## 3.3 Bar Graph of Retirees to Working Adults\n\nAs the current retirement age is at 68 years old and Singaporeans usually start work around 23 to 25 years old at graduation, we will use the population of those **above 68 years old** over the population of those **Aged 24 to 67** and find the **ratio of Retirees to working adults.**\n\n::: panel-tabset\n### The Plot\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Take-Home_Ex01_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n\n### The Code\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nadjusted_ageing_ratio_by_region <- resident_regioned %>%\n  mutate(Age_numeric = as.numeric(as.character(Age))) %>%\n  filter(!is.na(Age_numeric)) %>%\n  mutate(Age_Group = case_when(\n    Age_numeric >= 68 ~ \"68+\",\n    Age_numeric >= 24 & Age_numeric <= 67 ~ \"24-67\",\n    TRUE ~ \"Other\"\n  )) %>%\n  filter(Age_Group != \"Other\") %>%\n  group_by(Region, Age_Group) %>%\n  summarise(Population = sum(Population), .groups = \"drop\") %>%\n  pivot_wider(names_from = Age_Group, values_from = Population) %>%\n  mutate(Adjusted_Ageing_Ratio = `68+` / `24-67`)\n\nggplot(adjusted_ageing_ratio_by_region, aes(x = reorder(Region, Adjusted_Ageing_Ratio), y = Adjusted_Ageing_Ratio)) +\n  geom_col(fill = \"#80CBC4\") +\n  geom_text(aes(label = round(Adjusted_Ageing_Ratio, 3)), hjust = -0.1) +\n  expand_limits(y = max(adjusted_ageing_ratio_by_region$Adjusted_Ageing_Ratio) * 1.1) +\n  labs(\n    title = \"Ratio of Retirees(68YO+) to Working Adults(24-67YO)\",\n    x = \"Region\",\n    y = \"Adjusted Ageing Ratio\"\n  ) +\n  coord_flip() +\n  theme_minimal()\n```\n:::\n\n\n:::\n",
    "supporting": [
      "Take-Home_Ex01_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}